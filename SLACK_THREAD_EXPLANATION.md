# Slack スレッド機能について

## 現在の状況

現在はSlack Webhook URLを使用してメッセージを送信しています。これは正常に動作しますが、**Webhookではスレッド機能を使用できません**。

## なぜスレッドが使えないのか

1. **Webhook の制限**
   - Incoming Webhookは単純なメッセージ送信のみをサポート
   - `thread_ts` パラメータはサポートされていない
   - 一方向の通信のみ（メッセージIDの取得不可）

2. **Bot Token の権限問題**
   - 提供されたBot Tokenは存在する
   - しかし、Botがチャンネルに招待されていない
   - `not_in_channel` エラーが発生

## スレッド機能を使うための解決策

### オプション1: 現在のBotをチャンネルに追加（推奨）

1. Slackで対象チャンネルを開く
2. 以下のコマンドを入力：
   ```
   /invite @qwnotif
   ```
3. `.env.local` の設定を確認し、Web APIを使用するコードに戻す

### オプション2: 新しいSlack Appを作成

1. [Slack API](https://api.slack.com/apps) で新しいAppを作成
2. 必要な権限を付与：
   - `channels:join` - チャンネルに参加
   - `chat:write` - メッセージ送信
   - `chat:write.public` - パブリックチャンネルへの送信
3. Botをワークスペースにインストール
4. Bot Tokenを取得して環境変数に設定

### オプション3: 現在のWebhookを使い続ける（現在の実装）

- メリット：
  - 設定が簡単
  - 確実に動作する
  - チャンネルへの招待不要

- デメリット：
  - スレッド機能なし
  - 全ての情報が1つのメッセージに含まれる
  - チャンネルが混雑する可能性

## 現在の実装内容

```
メインチャンネルに1つのメッセージとして：
- 会社名とタイトル
- 送信日時とサイトタイプ
- お客様情報
- フォーム詳細内容（全て含む）
- Notionへのリンク
```

## 推奨事項

1. **短期的には**: 現在のWebhook実装を使用（動作確認済み）
2. **長期的には**: 
   - 既存のBot (@qwnotif) をチャンネルに招待
   - または新しいSlack Appを作成してスレッド機能を実装

スレッド機能が必要な場合は、Slack管理者に連絡してBotをチャンネルに追加してもらうか、新しいAppの作成権限を取得してください。