# Slack Bot Token + Web API 実装に必要なもの

## 現在の状況
- Bot Token: 環境変数に設定済み ✅
- Bot名: `@qwnotif` ✅
- 実装: Slack Web APIを使用したスレッド機能付き通知 ✅
- **問題**: Botがチャンネルに参加していない ❌

## 必要な作業

### 1. Botをチャンネルに招待する（最重要）

**Slackで以下の手順を実行してください：**

1. 通知を送りたいチャンネルを開く（例: `#general` または `#qw-form-notification`）
2. メッセージ入力欄に以下のコマンドを入力：
   ```
   /invite @qwnotif
   ```
3. Enterキーを押してBotを招待

### 2. チャンネルIDの確認と設定

現在の `.env.local` の設定：
```
SLACK_BOT_TOKEN=your-bot-token-here
SLACK_CHANNEL_ID=C08GWS8N24U
```

チャンネルIDを変更する場合：
1. Slackで対象チャンネルを右クリック
2. "View channel details" を選択
3. URLの最後の部分（Cで始まる文字列）がチャンネルID
4. `.env.local` の `SLACK_CHANNEL_ID` を更新

### 3. 必要な権限（すでに設定済み）

Botには以下の権限が必要です（現在のBotには設定済み）：
- `chat:write` - メッセージ送信権限
- `channels:read` - チャンネル情報読み取り
- `users:read` - ユーザー情報読み取り

## 動作確認方法

### 方法1: テストスクリプトを使用
```bash
node test-dev-notification.js
```

### 方法2: APIエンドポイントをテスト
```bash
curl http://localhost:3000/api/test-slack
```

### 方法3: 実際のフォーム送信をテスト
フォームを送信すると、Slackに以下の形式で通知されます：
- **メインチャンネル**: `@channel 【会社名】様よりフォームが入力されました！`
- **スレッド**: フォームの詳細内容

## よくある問題と解決方法

### 1. "not_in_channel" エラー
**原因**: Botがチャンネルに参加していない
**解決**: `/invite @qwnotif` コマンドでBotを招待

### 2. "channel_not_found" エラー
**原因**: チャンネルIDが間違っている
**解決**: 正しいチャンネルIDを確認して `.env.local` を更新

### 3. スレッドに投稿されない
**原因**: メインメッセージの送信に失敗している
**解決**: コンソールログを確認し、エラーメッセージを確認

## 現在の実装の特徴

1. **@channel メンション付き通知**
   - チャンネル全体に通知が届く
   - 重要なフォーム送信を見逃さない

2. **スレッド機能**
   - 詳細内容はスレッドに自動投稿
   - チャンネルがクリーンに保たれる

3. **構造化されたメッセージ**
   - 会社名、送信日時、サイトタイプが一目でわかる
   - Notionへのリンクボタン付き

## まとめ

**今すぐ必要な作業は1つだけ：**
```
/invite @qwnotif
```
をSlackチャンネルで実行してください。これで全ての機能が動作します。